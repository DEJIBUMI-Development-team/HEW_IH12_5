<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=, initial-scale=1.0">
		<title>Document</title>
		<style>
			.item {
				position: absolute;
				width: 100px;
				top: 20px;
				left: 20px;
				/* height: 100px; */
				/* writing-mode: vertical-rl;
				-webkit-writing-mode: vertical-rl;
				-ms-writing-mode: vertical-rl; */
				/* text-align: center; */
				/* background-color: rgb(224, 224, 224); */
				/* box-sizing: content-box; */
			}
			.border{
				border: solid 1px black;
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
			}

			.resizer {
				position: absolute;
				width: 10px;
				height: 10px;
				border-radius: 5px;
				background-color: blue;
				z-index: 2;
			}

			.resizer-tl {
				top: -5px;
				left: -5px;
				cursor: nw-resize;
			}

			.resizer-tr {
				top: -5px;
				right: -5px;
				cursor: ne-resize;
			}

			.resizer-bl {
				bottom: -5px;
				left: -5px;
				cursor: sw-resize;
			}

			.resizer-br {
				bottom: -5px;
				right: -5px;
				cursor: se-resize;
			}
		</style>
		
	</head>
	<body>
		<div class="item">
			<div class="border">
			<div class="resizer resizer-tl"></div>
			<div class="resizer resizer-tr"></div>
			<div class="resizer resizer-bl"></div>
			<div class="resizer resizer-br"></div>
			こんにちは
			</div>
		</div>
		<script>

			const el = document.querySelector(".item");
			
			//真の場合動作を行う
			let isResizing = false;
			
			//itemをクリックした際にmousedownを実行
			el.addEventListener("mousedown", mousedown);

			//itemがクリックされたとき
			function mousedown(e) {
				//移動時にmousemove、離れた時にmouseup関数を実行する
				window.addEventListener("mousemove", mousemove);
				window.addEventListener("mouseup", mouseup);
				// debugger;

				//現在地を取得
				let prevX = e.clientX;
				let prevY = e.clientY;
				// console.log("X:"+prevX+" Y:"+prevY);
				
				// mousemoveされたとき
				function mousemove(e) {

					// リサイズが行われていない場合
					if (!isResizing) {
						// X,Y座標値差 = 初期値 - 現在地点 
						let newX = prevX - e.clientX;
						let newY = prevY - e.clientY;

						// 現在地点を定数として取得
						const rect = el.getBoundingClientRect();

						// top left位置を再設定
						el.style.left = rect.left - newX + "px";
						el.style.top = rect.top - newY + "px";

						// カーソル位置を再取得
						prevX = e.clientX;
						prevY = e.clientY;
						// console.log("X:"+prevX+" Y:"+prevY);
					}
				}
				
				// itemからカーソルが離れた際にイベントを解除
				function mouseup() {
					window.removeEventListener("mousemove", mousemove);
					window.removeEventListener("mouseup", mouseup);
				}
			}

			//resizerのクラスをもつ要素すべてをresizersに定数として格納
			const resizers = document.querySelectorAll(".resizer");
			let currentResizer;

			for (let resizer of resizers) {
				// 各resizerに対し、mousedownイベントを付加
				resizer.addEventListener("mousedown", mousedown);
				debugger;

				function mousedown(e) {
					// リサイズを行う際の要素(resizer)を指定
					// リサイズを許可し、draggableアニメーションの発動をさせない
					currentResizer = e.target;
					isResizing = true;

					//　クリック時のカーソル座標を取得
					let prevX = e.clientX;
					let prevY = e.clientY;

					//mousemove mouseupイベントそれぞれを指定要素に付加
					window.addEventListener("mousemove", mousemove);
					window.addEventListener("mouseup", mouseup);

					//mousemoveイベント
					function mousemove(e) {
						// 要素の相対位置を取得
						const rect = el.getBoundingClientRect();

						// 指定要素に付加されているクラス名に応じて処理を変える　
						if (currentResizer.classList.contains("resizer-br")) {
							// 右下
							// 幅or高さ　-　(クリック時の座標-現在のカーソル位置)
							el.style.width = rect.width - (prevX - e.clientX) + "px";
							el.style.height = rect.height - (prevY - e.clientY) + "px";
							
						} else if (currentResizer.classList.contains("resizer-bl")) {
							// 左下 
							// 要素のleft値の変更を行わなければならない
							el.style.width = rect.width + (prevX - e.clientX) + "px";
							el.style.height = rect.height - (prevY - e.clientY) + "px";
							el.style.left = rect.left - (prevX - e.clientX) + "px";

						} else if (currentResizer.classList.contains("resizer-tr")) {
							// 右上 
							// 要素のtop値の変更を行わなければならない
							el.style.width = rect.width - (prevX - e.clientX) + "px";
							el.style.height = rect.height + (prevY - e.clientY) + "px";
							el.style.top = rect.top - (prevY - e.clientY) + "px";
						} else {
							// 左上
							// 要素の幅、高さ、top値、 left値すべての変更を行う
							el.style.width = rect.width + (prevX - e.clientX) + "px";
							el.style.height = rect.height + (prevY - e.clientY) + "px";
							el.style.top = rect.top - (prevY - e.clientY) + "px";
							el.style.left = rect.left - (prevX - e.clientX) + "px";
						}

						// 変更後のカーソル位置をprevに退避させる
						prevX = e.clientX;
						prevY = e.clientY;
					}

					//ボタンが外された場合Eventを除去
					function mouseup() {
						window.removeEventListener("mousemove", mousemove);
						window.removeEventListener("mouseup", mouseup);
						isResizing = false;
					}
				}
			}
		</script>
	</body>
</html>
